// nextflow.config

// Pipeline parameters
params {
    publish_dir_mode    = 'copy'
    // Input/output
    samplesheet         = null
    outdir              = "results"
    
    // Database paths
    taxdump             = null
    db_path             = null
    rfam_db             = "${projectDir}/assets/rfam_db.txt"
    
    // Processing options
    max_runs            = 100
    sourmash            = false
    swissprot           = false
    
    // Validation
    validate_params     = true
    cleanup_workdir     = true
    
}

cleanup = params.cleanup_workdir

includeConfig 'conf/base.config'
includeConfig 'conf/modules.config'

wave {
    enabled = true
    strategy = ['conda']
}

conda {
    enabled = true
    channels = ['conda-forge', 'bioconda', 'defaults']
}


profiles {
    conda {
        conda.enabled = true
    }
    
    docker {
        docker.enabled = true
        conda.enabled = false
        docker.registry = "quay.io"
        docker.runOptions = '-u $(id -u):$(id -g)'
    }
    
    singularity {
        singularity.enabled = true
        singularity.autoMounts = true
        singularity.registry = "quay.io"
        conda.enabled = false
    }

    local {
        includeConfig 'conf/local.config'
    }
}

// Process configuration
process {
    shell = ['/bin/bash', '-euo', 'pipefail']
    
    // Basic resource defaults
    cpus = 1
    memory = '4.GB'
    time = '2.h'
}

// Execution reports
timeline {
    enabled = true
    file = "${params.outdir}/pipeline_info/execution_timeline.html"
}
report {
    enabled = true
    file = "${params.outdir}/pipeline_info/execution_report.html"
}
trace {
    enabled = true
    file = "${params.outdir}/pipeline_info/execution_trace.txt"
}
dag {
    enabled = true
    file = "${params.outdir}/pipeline_info/pipeline_dag.svg"
}

// Pipeline manifest
manifest {
    name = 'Datascout'
    description =  "A pipeline for fetching protein and sequence data from multiple databases: ENA, UniProt, OrthoDB, and RFAM"
    version = '1.0.0'
    mainScript = 'main.nf'
    nextflowVersion = '>=23.04.0'
}

// nf-schema plugin for parameter validation
plugins {
    id 'nf-schema@2.1.0'
}